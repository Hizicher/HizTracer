<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="/static/styles.css" rel = "stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
        <title>HizTracer</title>

    </head>

    <body>
        
        <nav class="navbar navbar-expand-md navbar-light bg-light border-bottom"> 

            <div class="container-fluid">

                <a class="navbar-brand fw-bold" href="#">HizTracer</a> 
                
                <button type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" class="navbar-toggler" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarNav">

                    <ul class="navbar-nav">

                        <li class="nav-item active">
                             <a class="nav-link" href="#about">About</a>
                        </li>

                        <li class="nav-item active">
                             <a class="nav-link" href="#scene">Scene</a>
                        </li>

                        <li class="nav-item active">
                            <a class="nav-link" href="#render">Render</a>
                        </li>

                    </ul>

                </div>

            </div>

        </nav>

        <section id="about" class="container-my-4">
            <h2>HizTracer: A Demo for Rendering Raytraced Images</h2>

            <p>HizTracer is a demo for generating raytraced images with spheres, walls and lights of the user's choice. Additional to such objects, the user has also the ability to choose their camera position and image size. For more information please visit <a href="{{ url_for('static', filename='README.md') }}">HizTracer's user manual</a>.</p>
        </section>

        <section id="scene" class="container-my-4">

            <h2>Scene</h2>

            <form method="POST" action="/">

                <div class="row mb-3">

                        <label>Dimensions and Color of the Raytraced Image</label>

                    <div class="col-md-2">
                        <label>Width</label>
                        <input type="number" name="width" value="540" min="1" class="form-control" placeholder="Width" id="width" required>

                    </div>

                    <div class="col-md-2">
                        <label>Height</label>
                        <input type="number" name="height" value="400" min="1" class="form-control" placeholder="Height" id="Height" required>

                    </div>


                    <div class="col-md-2">
                        <label>Color (Background)</label>
                        <input type="text" name="sky_color" value="(0, 0, 0)" class="form-control" placeholder="Sky Color (R, G, B)" id="skyColor" required>

                    </div>

                </div>

                <div class="row mb-3">

                    <label>Camera Position</label>

                    <div class="col-md-2">

                        <input type="text" name="camera_position" value="(0, 0, -1)" class="form-control" placeholder="(x, y, z)" id="cameraPosition" required>

                    </div>


                </div>

                <div class="row mb-3">

                    <label>Add Spheres</label>

                    <div class="col-md-2">

                        <input type="number" name="amount_of_spheres" value="1" min="0" class="form-control" placeholder="Amount of Spheres" id="sphereAmount" required>

                    </div>

                </div>

                <div class="row mb-3" id ="sphereContainer">


                </div>

                <div class="row mb-3">

                    <label>Add Walls</label>

                    <div class="col-md-2">

                        <input type="number" name="amount_of_walls" value="1" min="0" class="form-control" placeholder="Amount of Walls" id="wallAmount" required>

                    </div>

                </div>

                <div class="row mb-3" id ="wallContainer">


                </div>

                <div class="row mb-3">

                    <label>Add Light</label>

                    <div class="col-md-2">

                        <input type="number" name="amount_of_lights" value="1" min="1" class="form-control" placeholder="Amount of Lights" id="lightAmount" required>

                    </div>

                </div>

                <div class="row mb-3" id ="lightContainer">


                </div>

                <button type="submit" class="btn btn-primary mb-3">
                    Render Scene
                </button>

            </form>


        </section>

        <section id="render" class="container-my-4 mb-3">

            <h2>Render</h2>

            {% if error %}

                <div class="alert alert-danger mb-3">{{ error }}</div>

            {% endif %}

            <p id="status">{% if not render_start %}Example Image Below!{% else %}Rendering...{% endif %}</p>
            <div class="progress">
                <div class="progress-bar" id="progress-bar" style="width:0%"></div>
            </div>
            <img id="page_image" src="{{ url_for('static', filename='default.png') }}">


        </section>

        <script>
            // Checks the progress of the rendering every 500 ms
            setInterval(() => {
                 
                fetch("/progress").then(r => r.text()).then(t => {

                    // Checking if the sent data in the right JSON format
                    try {

                        let currentStatus = document.getElementById("status"); // Changes the status depending if the program is still rendering or not
                        let img = document.getElementById("page_image"); // To change the default image to rendered image
                        let bar = document.getElementById("progress-bar") // To update the progress bar simulatenously with the rendering progress data gotten

                        const data = JSON.parse(t);
                        if(data.progress < 100 && data.progress > 0) { // Checks if the data.progress > 0 so that the program does not show rendering when scene is reset

                            bar.style.width = data.progress + "%";
                            currentStatus.innerHTML = "Rendering ... | " + data.progress + " % done.";
                            img.src = "static/image.png?t=" + Date.now();
                        }

                        if(data.progress == 100) {

                            img.src = "static/image.png?t=" + Date.now(); // So that the browser downloads image.png again as it is renewed
                            currentStatus.innerHTML = ''; // Deletes the "Rendering.." text when rendering is done
                            bar.style.width = "0%"; // Resets the bar

                        }
                        
                    }

                    catch(e) {

                        console.log("JSON data not found: ", t) // Debugs the invalid JSON data
                    }
                        
                });

            }, 500);

            document.addEventListener('DOMContentLoaded', function() {

                // JS gets data from HTML to see how many spheres the user wants so that it can print out that many forms, the same goes for the walls and the lights
                let amountSphere = document.getElementById("sphereAmount");
                let containerSphere = document.getElementById("sphereContainer");

                // Default values when entered on the website, the same goes for the walls and the lights
                containerSphere.innerHTML = `<div class="col-md-2">
                                                <h5>Sphere 1</h5>
                                                <label>Coordinates for the Center</label>
                                                <input type="text" name="sphere_center[]" value="(0.75, -0.1, 1)" class="form-control" placeholder="Center (x, y, z)" required>
                                                <label>Radius</label>
                                                <input type="number" name="sphere_radius[]" value="0.6" step="0.1" class="form-control" placeholder="Radius" required>
                                                <label>Color</label>
                                                <input type="text" name="sphere_color[]" value="(0, 0, 255)" class="form-control" placeholder="Color (R, G, B)" required>
                                                <label>Reflectivity</label>
                                                <input type="number" name="sphere_reflectivity[]" value="0.5" min="0" step="0.1" class="form-control" placeholder="Reflectivity (up to 1.00)" required>
                                                <label>Specular Shading Constant</label>
                                                <input type="number" name="sphere_specular_constant[]" value="32" min="0" class="form-control" placeholder="Specular Shading Constant" required>
                                                </div>`;

                amountSphere.addEventListener('input', function() {

                    containerSphere.innerHTML = ''; // Cleans the previous forms as there is a new value input for amountSpheres now
                    let countSphere = Number(amountSphere.value);

                    if (countSphere > 0) {

                        for(let i = 1; i <= countSphere; i++) { // Prints out that many form fields so that the user can input unique values for each sphere

                        containerSphere.innerHTML += `<div class="col-md-2">
                                                <h5>Sphere ${i}</h5>
                                                <label>Coordinates for the Center</label>
                                                <input type="text" name="sphere_center[]" class="form-control" placeholder="Center (x, y, z)" required>
                                                <label>Radius</label>
                                                <input type="number" name="sphere_radius[]" step="0.1" class="form-control" placeholder="Radius" required>
                                                <label>Color</label>
                                                <input type="text" name="sphere_color[]" class="form-control" placeholder="Color (R, G, B)" required>
                                                <label>Reflectivity</label>
                                                <input type="number" name="sphere_reflectivity[]" min="0" step="0.1" class="form-control" placeholder="Reflectivity (up to 1.00)" required>
                                                <label>Specular Shading Constant</label>
                                                <input type="number" name="sphere_specular_constant[]" min="0" class="form-control" placeholder="Specular Shading Constant" required>
                                                </div>`;

                        }

                    }
                });

                let amountWall = document.getElementById("wallAmount");
                let containerWall = document.getElementById("wallContainer");

                containerWall.innerHTML = `<div class="col-md-2">
                                                <h5>Wall 1</h5>
                                                <label>Upper Left Corner's Coordinates</label>
                                                <input type="text" name="left_upper_corner[]" value="(-3,  0.5, 0)" class="form-control" placeholder="Left Upper (x, y, z)" required>
                                                <label>Lower Left Corner's Coordinates</label>
                                                <input type="text" name="left_lower_corner[]" value="(-3,  0.5, 4)" class="form-control" placeholder="Left Lower (x, y, z)" required>
                                                <label>Upper Right Corner's Coordinates</label>
                                                <input type="text" name="right_upper_corner[]" value="(3, 0.5, 0)" class="form-control" placeholder="Right Upper (x, y, z)" required>
                                                <label>Lower Right Corner's Coordinates</label>
                                                <input type="text" name="right_lower_corner[]" value="(3, 0.5, 4)" class="form-control" placeholder="Right Lower (x, y, z)" required>
                                                <label>Color</label>
                                                <input type="text" name="wall_color[]" value="(120, 120, 120)" class="form-control" placeholder="Color (R, G, B)" required>
                                                <label>Reflectivity</label>
                                                <input type="number" name="wall_reflectivity[]" value="0" min="0" max="1" step="0.1" class="form-control" placeholder="Reflectivity (up to 1)" required>
                                                <label>Specular Shading Constant</label>
                                                <input type="number" name="wall_specular_constant[]" value="8" min="0" class="form-control" placeholder="Specular Shading Constant" required>
                                                </div>`;

                amountWall.addEventListener('input', function() {

                    containerWall.innerHTML = '';
                    let countWall = Number(amountWall.value);

                    if (countWall > 0) {

                        for(let i = 1; i <= countWall; i++) { 

                        containerWall.innerHTML += `<div class="col-md-2">
                                                <h5>Wall ${i}</h5>
                                                <label>Upper Left Corner's Coordinates</label>
                                                <input type="text" name="left_upper_corner[]" class="form-control" placeholder="Left Upper (x, y, z)" required>
                                                <label>Lower Left Corner's Coordinates</label>
                                                <input type="text" name="left_lower_corner[]" class="form-control" placeholder="Left Lower (x, y, z)" required>
                                                <label>Upper Right Corner's Coordinates</label>
                                                <input type="text" name="right_upper_corner[]" class="form-control" placeholder="Right Upper (x, y, z)" required>
                                                <label>Lower Right Corner's Coordinates</label>
                                                <input type="text" name="right_lower_corner[]" class="form-control" placeholder="Right Lower (x, y, z)" required>
                                                <label>Color</label>
                                                <input type="text" name="wall_color[]" class="form-control" placeholder="Color (R, G, B)" required>
                                                <label>Reflectivity</label>
                                                <input type="number" name="wall_reflectivity[]" min="0" max="1" step="0.1" class="form-control" placeholder="Reflectivity (up to 1)" required>
                                                <label>Specular Shading Constant</label>
                                                <input type="number" name="wall_specular_constant[]" min="0" class="form-control" placeholder="Specular Shading Constant" required>
                                                </div>`;

                        }

                    }
                });

                let amountLight = document.getElementById("lightAmount");
                let containerLight = document.getElementById("lightContainer");

                containerLight.innerHTML = `<div class="col-md-2">
                                                <h5>Light 1</h5>
                                                <label>Position Coordinates</label>
                                                <input type="text" name="light_position[]" value="(-0.5, -0.5, 0)" class="form-control" placeholder="Position (x, y, z)" required>
                                                <label>Color</label>
                                                <input type="text" name="light_color[]" value="(255, 255, 255)" class="form-control" placeholder="Color (R, G, B)" required>
                                                </div>`;

                amountLight.addEventListener('input', function() {

                    containerLight.innerHTML = '';
                    let countLight = Number(amountLight.value);

                    if (countLight > 0) {

                        for(let i = 1; i <= countLight; i++) {

                        containerLight.innerHTML += `<div class="col-md-2">
                                                <h5>Light ${i}</h5>
                                                <label>Position Coordinates</label>
                                                <input type="text" name="light_position[]" class="form-control" placeholder="Position (x, y, z)" required>
                                                <label>Color</label>
                                                <input type="text" name="light_color[]" class="form-control" placeholder="Color (R, G, B)" required>
                                                </div>`

                        }

                    }
                });

                
            });


        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    </body>

</html>

